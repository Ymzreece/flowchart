{
  "language": "text",
  "metadata": {
    "title": "Radar Door UI Firmware - Flowchart",
    "summary": "Structured flowchart of the on-device UI state machine, menus, and peripheral interactions for the radar-driven door firmware.",
    "language": "text"
  },
  "functions": [
    {
      "name": "Radar Door UI Firmware - Flowchart",
      "nodes": [
        {
          "id": "S_START",
          "kind": "start",
          "label": "System boots and enters the main UI loop.",
          "summary": "System boots and enters the main UI loop.",
          "metadata": {
            "title": "Start / Boot",
            "detail": null,
            "type": "start"
          }
        },
        {
          "id": "N_MENU_ACTIVE",
          "kind": "loop",
          "label": "Top-level state machine loop driving UI and peripheral actions; renders menus and reacts to events.",
          "summary": "Top-level state machine loop driving UI and peripheral actions; renders menus and reacts to events.",
          "metadata": {
            "title": "Main Flash_Task Loop",
            "detail": null,
            "type": "loop"
          }
        },
        {
          "id": "N_MENU_MAIN",
          "kind": "statement",
          "label": "Icon-based main menu with 3 items; handles navigation and selection, plus long-press actions.",
          "summary": "Icon-based main menu with 3 items; handles navigation and selection, plus long-press actions.",
          "metadata": {
            "title": "Main Menu (3 items)",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_DND",
          "kind": "statement",
          "label": "DND mode with silent/non-silent display behavior and PIR feedback; exits on any short press.",
          "summary": "DND mode with silent/non-silent display behavior and PIR feedback; exits on any short press.",
          "metadata": {
            "title": "Do Not Disturb",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_IDLE",
          "kind": "loop",
          "label": "Idle state; after timeout triggers low-power preparation and UI clearing, then resumes activity.",
          "summary": "Idle state; after timeout triggers low-power preparation and UI clearing, then resumes activity.",
          "metadata": {
            "title": "SYSTEM_IDLE",
            "detail": null,
            "type": "loop"
          }
        },
        {
          "id": "N_FACE_VERIFY",
          "kind": "statement",
          "label": "Placeholder for face verification flow integration.",
          "summary": "Placeholder for face verification flow integration.",
          "metadata": {
            "title": "FACE_VERIFYING",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_FACE_VERIFY_SUC",
          "kind": "statement",
          "label": "Face verification success path (no special handling in this flow).",
          "summary": "Face verification success path (no special handling in this flow).",
          "metadata": {
            "title": "FACE_VERIFY_SUCCESS",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_FACE_VERIFY_FAIL",
          "kind": "statement",
          "label": "Face verification failed; returns to idle and resets controls.",
          "summary": "Face verification failed; returns to idle and resets controls.",
          "metadata": {
            "title": "FACE_VERIFY_FAIL",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_FACE_ENROLL_SUC",
          "kind": "statement",
          "label": "Config save succeeded; returns to main menu.",
          "summary": "Config save succeeded; returns to main menu.",
          "metadata": {
            "title": "FACE_ENROLL_SUCCESS",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_FACE_ENROLL_FAIL",
          "kind": "statement",
          "label": "Config save failed; returns to main menu.",
          "summary": "Config save failed; returns to main menu.",
          "metadata": {
            "title": "FACE_ENROLL_FAIL",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_FACE_DELETE_SUC",
          "kind": "statement",
          "label": "Reset of all face data succeeded; returns to main menu.",
          "summary": "Reset of all face data succeeded; returns to main menu.",
          "metadata": {
            "title": "FACE_DELETE_SUCCESS",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_FACE_DELETE_FAIL",
          "kind": "statement",
          "label": "Reset of face data failed; returns to main menu.",
          "summary": "Reset of face data failed; returns to main menu.",
          "metadata": {
            "title": "FACE_DELETE_FAIL",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_HANDLE_CONFIG",
          "kind": "call",
          "label": "Config flow entry: load current user config, show defaults if missing, and open angle/speed editor.",
          "summary": "Config flow entry: load current user config, show defaults if missing, and open angle/speed editor.",
          "metadata": {
            "title": "handle_config_menu",
            "detail": null,
            "type": "call"
          }
        },
        {
          "id": "N_MENU3_AngSpeed",
          "kind": "statement",
          "label": "Angle/Speed/Auto Close editor with Save/Exit options.",
          "summary": "Angle/Speed/Auto Close editor with Save/Exit options.",
          "metadata": {
            "title": "menu3_angle_speed",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_HANDLE_ELSE_MODE",
          "kind": "call",
          "label": "Else Mode submenu: DND, Door Reset, Back.",
          "summary": "Else Mode submenu: DND, Door Reset, Back.",
          "metadata": {
            "title": "handle_else_mode_menu",
            "detail": null,
            "type": "call"
          }
        },
        {
          "id": "N_HANDLE_RESET",
          "kind": "call",
          "label": "Hidden Door Calibration flow: beacon signals, 10s progress, then return to menu.",
          "summary": "Hidden Door Calibration flow: beacon signals, 10s progress, then return to menu.",
          "metadata": {
            "title": "handle_Reset_menu",
            "detail": null,
            "type": "call"
          }
        },
        {
          "id": "N_HANDLE_DELETE",
          "kind": "call",
          "label": "Delete/Reset flow: Reset All or Reset Single prompts.",
          "summary": "Delete/Reset flow: Reset All or Reset Single prompts.",
          "metadata": {
            "title": "handle_delete_menu",
            "detail": null,
            "type": "call"
          }
        },
        {
          "id": "N_DELETE_SINGLE_PROMPT",
          "kind": "statement",
          "label": "Prompts for single reset; no single-delete logic implemented yet.",
          "summary": "Prompts for single reset; no single-delete logic implemented yet.",
          "metadata": {
            "title": "Reset Single Prompt",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_DELETE_PROGRESS",
          "kind": "statement",
          "label": "5s progress bar while clearing all user data; reports success or failure.",
          "summary": "5s progress bar while clearing all user data; reports success or failure.",
          "metadata": {
            "title": "Delete All Progress",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_FLASH_SAVE_CONFIG",
          "kind": "statement",
          "label": "Erase, write, and verify a user config in flash with CRC checks.",
          "summary": "Erase, write, and verify a user config in flash with CRC checks.",
          "metadata": {
            "title": "Flash Save Config",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_SYS_ERROR",
          "kind": "statement",
          "label": "Default/unknown state; shows error then returns to idle.",
          "summary": "Default/unknown state; shows error then returns to idle.",
          "metadata": {
            "title": "System Error",
            "detail": null,
            "type": "process"
          }
        },
        {
          "id": "N_END",
          "kind": "end",
          "label": "Flow terminated for this path.",
          "summary": "Flow terminated for this path.",
          "metadata": {
            "title": "End",
            "detail": null,
            "type": "end"
          }
        }
      ],
      "edges": [
        {
          "source": "S_START",
          "target": "N_MENU_ACTIVE",
          "label": "Power-on complete -> enter main loop"
        },
        {
          "source": "N_MENU_ACTIVE",
          "target": "N_MENU_MAIN",
          "label": "Render main menu and await input"
        },
        {
          "source": "N_MENU_MAIN",
          "target": "N_HANDLE_CONFIG",
          "label": "Item 1 selected (short)"
        },
        {
          "source": "N_MENU_MAIN",
          "target": "N_HANDLE_ELSE_MODE",
          "label": "Item 2 selected (short)"
        },
        {
          "source": "N_MENU_MAIN",
          "target": "N_IDLE",
          "label": "Item 3 Back (short)"
        },
        {
          "source": "N_MENU_MAIN",
          "target": "N_DND",
          "label": "Key 3 long (13) enters DND"
        },
        {
          "source": "N_MENU_MAIN",
          "target": "N_HANDLE_RESET",
          "label": "Key 2 long (12) enters Calibration"
        },
        {
          "source": "N_DND",
          "target": "N_DND",
          "label": "PIR motion within last 5s (non-silent)"
        },
        {
          "source": "N_DND",
          "target": "N_DND",
          "label": "No PIR motion within last 5s"
        },
        {
          "source": "N_DND",
          "target": "N_IDLE",
          "label": "short press any key -> exit DND"
        },
        {
          "source": "N_IDLE",
          "target": "N_MENU_MAIN",
          "label": "Key press wakes up -> main menu"
        },
        {
          "source": "N_MENU_ACTIVE",
          "target": "N_SYS_ERROR",
          "label": "Unhandled state (default)"
        },
        {
          "source": "N_SYS_ERROR",
          "target": "N_END",
          "label": "Terminate flow"
        },
        {
          "source": "N_HANDLE_CONFIG",
          "target": "N_MENU3_AngSpeed",
          "label": "Enter config editor"
        },
        {
          "source": "N_MENU3_AngSpeed",
          "target": "N_FLASH_SAVE_CONFIG",
          "label": "Select Save (Item 4)"
        },
        {
          "source": "N_MENU3_AngSpeed",
          "target": "N_FACE_ENROLL_FAIL",
          "label": "Exit cancel (Item 5)"
        },
        {
          "source": "N_FLASH_SAVE_CONFIG",
          "target": "N_FACE_ENROLL_SUC",
          "label": "Save successful"
        },
        {
          "source": "N_FLASH_SAVE_CONFIG",
          "target": "N_FACE_ENROLL_FAIL",
          "label": "Save failed"
        },
        {
          "source": "N_FACE_ENROLL_SUC",
          "target": "N_MENU_ACTIVE",
          "label": "Return to main menu"
        },
        {
          "source": "N_FACE_ENROLL_FAIL",
          "target": "N_MENU_ACTIVE",
          "label": "Return to main menu"
        },
        {
          "source": "N_HANDLE_ELSE_MODE",
          "target": "N_DND",
          "label": "1: Do Not Disturb"
        },
        {
          "source": "N_HANDLE_ELSE_MODE",
          "target": "N_HANDLE_RESET",
          "label": "2: Door Reset"
        },
        {
          "source": "N_HANDLE_ELSE_MODE",
          "target": "N_MENU_MAIN",
          "label": "3: Back"
        },
        {
          "source": "N_HANDLE_RESET",
          "target": "N_MENU_ACTIVE",
          "label": "Calibration complete -> Back to main"
        },
        {
          "source": "N_HANDLE_DELETE",
          "target": "N_DELETE_PROGRESS",
          "label": "1: Reset All"
        },
        {
          "source": "N_HANDLE_DELETE",
          "target": "N_DELETE_SINGLE_PROMPT",
          "label": "2: Reset Single"
        },
        {
          "source": "N_DELETE_SINGLE_PROMPT",
          "target": "N_HANDLE_DELETE",
          "label": "any key -> return"
        },
        {
          "source": "N_DELETE_PROGRESS",
          "target": "N_FACE_DELETE_SUC",
          "label": "success"
        },
        {
          "source": "N_DELETE_PROGRESS",
          "target": "N_FACE_DELETE_FAIL",
          "label": "failure/timeout"
        },
        {
          "source": "N_FACE_DELETE_SUC",
          "target": "N_MENU_ACTIVE",
          "label": "Return to main"
        },
        {
          "source": "N_FACE_DELETE_FAIL",
          "target": "N_MENU_ACTIVE",
          "label": "Return to main"
        }
      ],
      "parameters": [],
      "metadata": {
        "entry_node": "S_START"
      },
      "docstring": "Structured flowchart of the on-device UI state machine, menus, and peripheral interactions for the radar-driven door firmware."
    }
  ]
}