{
  "metadata": {
    "title": "Radar Door UI Firmware - Flowchart",
    "summary": "Structured flowchart of the on-device UI state machine, menus, and peripheral interactions for the radar-driven door firmware.",
    "language": "text"
  },
  "entry_node": "S_START",
  "nodes": [
    {
      "id": "S_START",
      "title": "Start / Boot",
      "summary": "System boots and enters the main UI loop.",
      "detail": null,
      "type": "start"
    },
    {
      "id": "N_MENU_ACTIVE",
      "title": "Main Flash_Task Loop",
      "summary": "Top-level state machine loop driving UI and peripheral actions; renders menus and reacts to events.",
      "detail": null,
      "type": "loop"
    },
    {
      "id": "N_MENU_MAIN",
      "title": "Main Menu (3 items)",
      "summary": "Icon-based main menu with 3 items; handles navigation and selection, plus long-press actions.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_DND",
      "title": "Do Not Disturb",
      "summary": "DND mode with silent/non-silent display behavior and PIR feedback; exits on any short press.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_IDLE",
      "title": "SYSTEM_IDLE",
      "summary": "Idle state; after timeout triggers low-power preparation and UI clearing, then resumes activity.",
      "detail": null,
      "type": "loop"
    },
    {
      "id": "N_FACE_VERIFY",
      "title": "FACE_VERIFYING",
      "summary": "Placeholder for face verification flow integration.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_FACE_VERIFY_SUC",
      "title": "FACE_VERIFY_SUCCESS",
      "summary": "Face verification success path (no special handling in this flow).",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_FACE_VERIFY_FAIL",
      "title": "FACE_VERIFY_FAIL",
      "summary": "Face verification failed; returns to idle and resets controls.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_FACE_ENROLL_SUC",
      "title": "FACE_ENROLL_SUCCESS",
      "summary": "Config save succeeded; returns to main menu.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_FACE_ENROLL_FAIL",
      "title": "FACE_ENROLL_FAIL",
      "summary": "Config save failed; returns to main menu.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_FACE_DELETE_SUC",
      "title": "FACE_DELETE_SUCCESS",
      "summary": "Reset of all face data succeeded; returns to main menu.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_FACE_DELETE_FAIL",
      "title": "FACE_DELETE_FAIL",
      "summary": "Reset of face data failed; returns to main menu.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_HANDLE_CONFIG",
      "title": "handle_config_menu",
      "summary": "Config flow entry: load current user config, show defaults if missing, and open angle/speed editor.",
      "detail": null,
      "type": "call"
    },
    {
      "id": "N_MENU3_AngSpeed",
      "title": "menu3_angle_speed",
      "summary": "Angle/Speed/Auto Close editor with Save/Exit options.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_HANDLE_ELSE_MODE",
      "title": "handle_else_mode_menu",
      "summary": "Else Mode submenu: DND, Door Reset, Back.",
      "detail": null,
      "type": "call"
    },
    {
      "id": "N_HANDLE_RESET",
      "title": "handle_Reset_menu",
      "summary": "Hidden Door Calibration flow: beacon signals, 10s progress, then return to menu.",
      "detail": null,
      "type": "call"
    },
    {
      "id": "N_HANDLE_DELETE",
      "title": "handle_delete_menu",
      "summary": "Delete/Reset flow: Reset All or Reset Single prompts.",
      "detail": null,
      "type": "call"
    },
    {
      "id": "N_DELETE_SINGLE_PROMPT",
      "title": "Reset Single Prompt",
      "summary": "Prompts for single reset; no single-delete logic implemented yet.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_DELETE_PROGRESS",
      "title": "Delete All Progress",
      "summary": "5s progress bar while clearing all user data; reports success or failure.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_FLASH_SAVE_CONFIG",
      "title": "Flash Save Config",
      "summary": "Erase, write, and verify a user config in flash with CRC checks.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_SYS_ERROR",
      "title": "System Error",
      "summary": "Default/unknown state; shows error then returns to idle.",
      "detail": null,
      "type": "process"
    },
    {
      "id": "N_END",
      "title": "End",
      "summary": "Flow terminated for this path.",
      "detail": null,
      "type": "end"
    }
  ],
  "edges": [
    {
      "source": "S_START",
      "target": "N_MENU_ACTIVE",
      "label": "Power-on complete -> enter main loop"
    },
    {
      "source": "N_MENU_ACTIVE",
      "target": "N_MENU_MAIN",
      "label": "Render main menu and await input"
    },
    {
      "source": "N_MENU_MAIN",
      "target": "N_HANDLE_CONFIG",
      "label": "Item 1 selected (short)"
    },
    {
      "source": "N_MENU_MAIN",
      "target": "N_HANDLE_ELSE_MODE",
      "label": "Item 2 selected (short)"
    },
    {
      "source": "N_MENU_MAIN",
      "target": "N_IDLE",
      "label": "Item 3 Back (short)"
    },
    {
      "source": "N_MENU_MAIN",
      "target": "N_DND",
      "label": "Key 3 long (13) enters DND"
    },
    {
      "source": "N_MENU_MAIN",
      "target": "N_HANDLE_RESET",
      "label": "Key 2 long (12) enters Calibration"
    },
    {
      "source": "N_DND",
      "target": "N_DND",
      "label": "PIR motion within last 5s (non-silent)"
    },
    {
      "source": "N_DND",
      "target": "N_DND",
      "label": "No PIR motion within last 5s"
    },
    {
      "source": "N_DND",
      "target": "N_IDLE",
      "label": "short press any key -> exit DND"
    },
    {
      "source": "N_IDLE",
      "target": "N_MENU_MAIN",
      "label": "Key press wakes up -> main menu"
    },
    {
      "source": "N_MENU_ACTIVE",
      "target": "N_SYS_ERROR",
      "label": "Unhandled state (default)"
    },
    {
      "source": "N_SYS_ERROR",
      "target": "N_END",
      "label": "Terminate flow"
    },
    {
      "source": "N_HANDLE_CONFIG",
      "target": "N_MENU3_AngSpeed",
      "label": "Enter config editor"
    },
    {
      "source": "N_MENU3_AngSpeed",
      "target": "N_FLASH_SAVE_CONFIG",
      "label": "Select Save (Item 4)"
    },
    {
      "source": "N_MENU3_AngSpeed",
      "target": "N_FACE_ENROLL_FAIL",
      "label": "Exit cancel (Item 5)"
    },
    {
      "source": "N_FLASH_SAVE_CONFIG",
      "target": "N_FACE_ENROLL_SUC",
      "label": "Save successful"
    },
    {
      "source": "N_FLASH_SAVE_CONFIG",
      "target": "N_FACE_ENROLL_FAIL",
      "label": "Save failed"
    },
    {
      "source": "N_FACE_ENROLL_SUC",
      "target": "N_MENU_ACTIVE",
      "label": "Return to main menu"
    },
    {
      "source": "N_FACE_ENROLL_FAIL",
      "target": "N_MENU_ACTIVE",
      "label": "Return to main menu"
    },
    {
      "source": "N_HANDLE_ELSE_MODE",
      "target": "N_DND",
      "label": "1: Do Not Disturb"
    },
    {
      "source": "N_HANDLE_ELSE_MODE",
      "target": "N_HANDLE_RESET",
      "label": "2: Door Reset"
    },
    {
      "source": "N_HANDLE_ELSE_MODE",
      "target": "N_MENU_MAIN",
      "label": "3: Back"
    },
    {
      "source": "N_HANDLE_RESET",
      "target": "N_MENU_ACTIVE",
      "label": "Calibration complete -> Back to main"
    },
    {
      "source": "N_HANDLE_DELETE",
      "target": "N_DELETE_PROGRESS",
      "label": "1: Reset All"
    },
    {
      "source": "N_HANDLE_DELETE",
      "target": "N_DELETE_SINGLE_PROMPT",
      "label": "2: Reset Single"
    },
    {
      "source": "N_DELETE_SINGLE_PROMPT",
      "target": "N_HANDLE_DELETE",
      "label": "any key -> return"
    },
    {
      "source": "N_DELETE_PROGRESS",
      "target": "N_FACE_DELETE_SUC",
      "label": "success"
    },
    {
      "source": "N_DELETE_PROGRESS",
      "target": "N_FACE_DELETE_FAIL",
      "label": "failure/timeout"
    },
    {
      "source": "N_FACE_DELETE_SUC",
      "target": "N_MENU_ACTIVE",
      "label": "Return to main"
    },
    {
      "source": "N_FACE_DELETE_FAIL",
      "target": "N_MENU_ACTIVE",
      "label": "Return to main"
    }
  ]
}